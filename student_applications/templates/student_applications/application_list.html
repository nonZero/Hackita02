{% extends 'users/base.html' %}
{% load i18n humanize hackita sa users %}

{% block content %}

    <h1 class="page-title">
        {% trans "Applications" %}
    </h1>

    <ul class="list-inline">
        <li>
            <a href="{% url "sa:app_list" %}"
               class="label label-{% if not view.status %}primary{% else %}default{% endif %}">{% trans "Total" %}: {{ total }}</a>
        </li>
        {% for group in agg %}
            <li>
                <a href="{% url "sa:app_list" %}?status={{ group.status }}"
                   class="label label-{% if view.status == group.status %}primary{% else %}default{% endif %}">{{ group.label }}: {{ group.count }}</a>
            </li>

        {% endfor %}

    </ul>

    <form method="post">

        <ul class="list-group">
            {% for app in object_list %}
                {% with app.user as u %}

                    <li class="list-group-item">

                        <input type="checkbox" name="users"
                               value="{{ app.user.id }}" checked="1">
                        {{ forloop.counter }}.

                        {{ app.user|u }}

                        <span dir="ltr">&lt;{{ u.email }}&gt;</span>

                        {% app_status app %}

                        &nbsp;

                        <span title="{{ app.last_form_filled }}">
                            {{ app.last_form_filled|naturaltime }}
                        </span>

                        {% user_tags app.user %}

                    </li>
                {% endwith %}
            {% endfor %}
        </ul>

        <div class="panel panel-default">
            <div class="panel-heading">
                <a href="#bulk" data-toggle="collapse">
                    {% trans "Bulk Operations" %}
                </a>
            </div>
            <div class="panel-body collapse" id="bulk">
                <div class="pull-right">
                    <i class="fa fa-check-square select-all"></i>
                    <i class="fa fa-square select-none"></i>
                </div>
                <div class="row">
                    <div class="col-sm-3">{{ statuses }}</div>
                    <div class="col-sm-3">{{ surveys }}</div>
                    <button class="btn btn-default">{% trans "Send survey" %}</button>
                </div>
            </div>
        </div>


        {% csrf_token %}
    </form>

{% endblock %}

{% block scripts %}
    <script>
        $(function() {
            var mark = function(b) {
                $(':checkbox').prop('checked', b);
            }
            $(".select-all").click(function() {
                mark(true);
            });
            $(".select-none").click(function() {
                mark(false);
            });
        })
    </script>

{% endblock %}

